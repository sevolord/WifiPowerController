# WifiPowerController

Управляемая Wi‑Fi розетка на базе Wemos Mini (ESP8266) и реле 220 В. Включение и выключение нагрузки из веб-интерфейса и по расписанию (таймер на каждый день недели).

## Возможности

- **Реле** — включение/выключение из веб-интерфейса, отображение текущего состояния.
- **Расписание** — время включения и выключения на каждый день недели (Пн–Вс); кнопка «Применить ко всем дням» для одинакового расписания.
- **Время** — синхронизация по NTP (GyverNTP), автоматическое переключение по расписанию.
- **Настройки** — Wi‑Fi (SSID/пароль) и расписание хранятся в LittleFS (GyverDB), сохраняются после перезагрузки.

## Железо

- **Плата:** Wemos Mini (ESP8266).
- **Реле:** модуль на 220 В с логикой 5 В, управление по **GPIO 5** (D1 на Wemos).

## Зависимости (Arduino Library Manager)

- **GyverNTP** — время по NTP.
- **Settings** — веб-интерфейс настроек.
- Для Settings дополнительно: GTL, GyverDB, StringUtils, GyverHTTP, BSON, Stamp, Table (указаны в `library.properties` библиотеки Settings).

Локальные копии `libraries/GyverNTP` и `libraries/Settings` лежат в репозитории для контекста; сборка идёт с библиотеками из менеджера библиотек Arduino.

## Сборка и прошивка

1. Открыть `WIFIPowerManager.ino` в Arduino IDE.
2. Выбрать плату: **Wemos D1 R2 & mini** (или аналог ESP8266).
3. Установить перечисленные выше библиотеки.
4. Скомпилировать и загрузить скетч.

## Первый запуск и использование

1. **Точка доступа.** После включения устройство поднимает AP с именем **WifiPowerManager**. Подключитесь к ней с телефона или ПК.
2. **Вход в настройки.** Откройте в браузере адрес точки доступа (обычно **192.168.4.1**). Откроется веб-морда Settings.
3. **Wi‑Fi.** В разделе «Wi‑Fi» введите SSID и пароль вашей сети, нажмите «Сохранить и перезагрузить». После перезагрузки устройство подключится к роутеру; в Serial выведется IP в локальной сети — по нему можно заходить в настройки дальше.
4. **Реле.** В разделе «Реле» — текущее состояние и переключатель Вкл/Выкл.
5. **Расписание.** В «Расписание по дням» для каждого дня задаётся время включения и выключения в формате **HH:MM** (например, 08:00 и 22:00). В блоке «Задать для каждого дня» можно ввести одно время вкл/выкл и нажать «Применить ко всем дням».

Часовой пояс задаётся в коде константой `GMT_OFFSET` (по умолчанию 3 — Москва).

---

*Изначально проект был собран «на коленке», чтобы удалённо перезагружать офисный компьютер по питанию (Wemos Mini + реле в корпусе из Fix Price). Сейчас переведён на современный стек: Settings, GyverNTP, хранение настроек в LittleFS.*
